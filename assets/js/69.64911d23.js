(window.webpackJsonp=window.webpackJsonp||[]).push([[69],{334:function(v,_,e){"use strict";e.r(_);var t=e(14),a=Object(t.a)({},(function(){var v=this,_=v._self._c;return _("ContentSlotsDistributor",{attrs:{"slot-key":v.$parent.slotKey}},[_("h1",{attrs:{id:"watchpack"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#watchpack"}},[v._v("#")]),v._v(" "),_("a",{attrs:{href:"https://github.com/webpack/watchpack",target:"_blank",rel:"noopener noreferrer"}},[v._v("watchpack"),_("OutboundLink")],1)]),v._v(" "),_("blockquote",[_("p",[_("code",[v._v("webpack")]),v._v(" 的 "),_("code",[v._v("file watcher")]),v._v(" 独立包\n去重监听指定文件列表和文件夹列表的变化，维护对应变化时间戳map；用于 "),_("code",[v._v("webpack")]),v._v(" 对比判断 "),_("code",[v._v("module")]),v._v(" 重编")]),v._v(" "),_("ol",[_("li",[v._v("事件管理"),_("code",[v._v("events.EventEmitter")])]),v._v(" "),_("li",[v._v("文件监听"),_("code",[v._v("chokidar.watch")])])])]),v._v(" "),_("h3",{attrs:{id:"定义文件事件"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#定义文件事件"}},[v._v("#")]),v._v(" 定义文件事件")]),v._v(" "),_("ul",[_("li",[_("code",[v._v("change")]),v._v(" 文件/文件夹修改")]),v._v(" "),_("li",[_("code",[v._v("remove")]),v._v(" 文件被删除")]),v._v(" "),_("li",[_("code",[v._v("aggregated")]),v._v(" "),_("ul",[_("li",[v._v("事件"),_("code",[v._v("change")]),v._v("与"),_("code",[v._v("remove")]),v._v("的聚合")]),v._v(" "),_("li",[v._v("根据"),_("code",[v._v("options.aggregateTimeout")]),v._v("用"),_("code",[v._v("timeout")]),v._v("方式\n"),_("ul",[_("li",[v._v("去抖动(debounce)；")]),v._v(" "),_("li",[v._v("聚合timeout时间内变化的文件/文件夹(数组)")])])])])])]),v._v(" "),_("h3",{attrs:{id:"定义状态机"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#定义状态机"}},[v._v("#")]),v._v(" 定义状态机")]),v._v(" "),_("ul",[_("li",[v._v("操作\n"),_("ul",[_("li",[v._v("开始 "),_("code",[v._v("watch()")]),v._v("：开始监听")]),v._v(" "),_("li",[v._v("关闭 "),_("code",[v._v("close()")]),v._v("：关闭监听")]),v._v(" "),_("li",[v._v("暂停 "),_("code",[v._v("pause()")]),v._v("：仍监听，但事件不透出，以状态值"),_("code",[v._v("paused")]),v._v("做判断")])])]),v._v(" "),_("li",[v._v("状态\n"),_("ul",[_("li",[_("code",[v._v("paused")])])])])]),v._v(" "),_("h3",{attrs:{id:"文件监听"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#文件监听"}},[v._v("#")]),v._v(" 文件监听")]),v._v(" "),_("ul",[_("li",[v._v("文件/文件夹的监听聚合到文件夹的去重监听（每层目录一个观察者/监听器map实例共享）；")]),v._v(" "),_("li",[v._v("因聚合到文件夹，且只需监听指定的文件/文件夹，作"),_("strong",[v._v("计数器")]),v._v("计数，指定的都删除了即可不再监听此层目录")]),v._v(" "),_("li",[v._v("如果指定的是文件夹，"),_("strong",[v._v("递归")]),v._v("监听内部所有目录的变化，某个目录变化，即这个文件夹变化")]),v._v(" "),_("li",[v._v("根据变更时间"),_("code",[v._v("stat.mtime")]),v._v("/"),_("code",[v._v("stat.ctime")]),v._v("触发相关事件")])]),v._v(" "),_("h3",{attrs:{id:"细节"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#细节"}},[v._v("#")]),v._v(" 细节")]),v._v(" "),_("ul",[_("li",[v._v("文件路径小写处理")]),v._v(" "),_("li",[v._v("在必要的函数内再引用文件，避免循环引用")])])])}),[],!1,null,null,null);_.default=a.exports}}]);