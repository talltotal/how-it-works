(window.webpackJsonp=window.webpackJsonp||[]).push([[53],{318:function(e,t,o){"use strict";o.r(t);var r=o(14),n=Object(r.a)({},(function(){var e=this,t=e._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"vetur"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#vetur"}},[e._v("#")]),e._v(" "),t("a",{attrs:{href:"https://vuejs.github.io/vetur",target:"_blank",rel:"noopener noreferrer"}},[e._v("Vetur"),t("OutboundLink")],1)]),e._v(" "),t("h2",{attrs:{id:"功能"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#功能"}},[e._v("#")]),e._v(" 功能")]),e._v(" "),t("ul",[t("li",[e._v("根据大标签的type，做不同处理：高亮 / lint")]),e._v(" "),t("li",[e._v("自动补全 component names 和 attributes")])]),e._v(" "),t("h2",{attrs:{id:"工程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#工程"}},[e._v("#")]),e._v(" 工程")]),e._v(" "),t("ul",[t("li",[e._v("vuepress 为文档工具\n"),t("ul",[t("li",[e._v("分支 "),t("code",[e._v("gh-pages")])]),e._v(" "),t("li",[e._v("md文档正常编辑，增加vuepress配置")]),e._v(" "),t("li",[e._v("需要更新文档时，执行脚本\n"),t("ol",[t("li",[e._v("执行build；")]),e._v(" "),t("li",[e._v("在交付件文件夹构建git环境；")]),e._v(" "),t("li",[e._v("强推到分支；")]),e._v(" "),t("li",[e._v("清除交付件")])])])]),e._v(" "),t("blockquote",[t("p",[e._v("源码与交付件分离；交付件分支无需git跟踪")])])]),e._v(" "),t("li",[e._v("husky + lint-staged + (tslint + prettier) 为自动语法lint")]),e._v(" "),t("li",[e._v("ts 为编程语言和编译工具\n"),t("ul",[t("li",[e._v("入口配置文件 "),t("code",[e._v("./tsconfig.json")]),e._v(" => "),t("code",[e._v("references")])]),e._v(" "),t("li",[e._v("scripts、client、server、test 四个模块不同编译配置，都继承("),t("code",[e._v("extends")]),e._v(") "),t("code",[e._v("./tsconfig.options.json")]),e._v(" "),t("ul",[t("li",[e._v("scripts: 默认语法文件导出脚本")]),e._v(" "),t("li",[e._v("test: 测试")])])])])])]),e._v(" "),t("h2",{attrs:{id:"语言插件基础"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#语言插件基础"}},[e._v("#")]),e._v(" 语言插件基础")]),e._v(" "),t("ul",[t("li",[e._v("定位："),t("a",{attrs:{href:"https://code.visualstudio.com/api/language-extensions/overview#programmatic-language-features",target:"_blank",rel:"noopener noreferrer"}},[e._v("Language Extensions"),t("OutboundLink")],1),e._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://code.visualstudio.com/api/language-extensions/syntax-highlight-guide",target:"_blank",rel:"noopener noreferrer"}},[e._v("语法高亮"),t("OutboundLink")],1),e._v(" "),t("ul",[t("li",[e._v("原理\n"),t("ol",[t("li",[t("a",{attrs:{href:"https://macromates.com/manual/en/language_grammars",target:"_blank",rel:"noopener noreferrer"}},[e._v("分词 - TextMate"),t("OutboundLink")],1)]),e._v(" "),t("li",[e._v("样式映射")])])]),e._v(" "),t("li",[e._v("配置方式\n"),t("ol",[t("li",[e._v("在"),t("code",[e._v("package.json")]),e._v("里配置"),t("code",[e._v("contributes.grammars")])]),e._v(" "),t("li",[e._v("在对应的"),t("code",[e._v("tmLanguage")]),e._v("文件中定义语法\n"),t("blockquote",[t("p",[e._v("如"),t("a",{attrs:{href:"https://github.com/microsoft/vscode/tree/main/extensions/handlebars",target:"_blank",rel:"noopener noreferrer"}},[e._v("handlebars"),t("OutboundLink")],1)])]),e._v(" "),t("ul",[t("li",[e._v("在"),t("code",[e._v("patterns")]),e._v("数组中"),t("code",[e._v("start")]),e._v("+"),t("code",[e._v("end")]),e._v("匹配，"),t("code",[e._v("name")]),e._v("对应高亮样式，再在"),t("code",[e._v("patterns")]),e._v("中匹配"),t("code",[e._v("start")]),e._v("和"),t("code",[e._v("end")]),e._v("之间的剩余文本")]),e._v(" "),t("li",[e._v("可以使用"),t("code",[e._v("include")]),e._v("引用vscode内置的语法或当前工程定义的语法"),t("code",[e._v("repository")])])])])])])])]),e._v(" "),t("li",[t("a",{attrs:{href:"https://code.visualstudio.com/api/language-extensions/language-configuration-guide",target:"_blank",rel:"noopener noreferrer"}},[e._v("Language Configuration Guide"),t("OutboundLink")],1),e._v(" "),t("ul",[t("li",[e._v("注释 Comment toggling")]),e._v(" "),t("li",[e._v("代码块 Brackets definition")]),e._v(" "),t("li",[e._v("自动关闭 Autoclosing")]),e._v(" "),t("li",[e._v("自动包裹 Autosurrounding")]),e._v(" "),t("li",[e._v("折叠 Folding")]),e._v(" "),t("li",[e._v("写字板 Word pattern")]),e._v(" "),t("li",[e._v("缩进规则 Indentation Rules")])])]),e._v(" "),t("li",[t("a",{attrs:{href:"https://code.visualstudio.com/api/language-extensions/programmatic-language-features",target:"_blank",rel:"noopener noreferrer"}},[e._v("Programmatic Language Features"),t("OutboundLink")],1),e._v(" "),t("ul",[t("li",[e._v("ways\n"),t("ol",[t("li",[t("a",{attrs:{href:"https://code.visualstudio.com/api/references/vscode-api#languages.registerHoverProvider",target:"_blank",rel:"noopener noreferrer"}},[e._v("vscode.languages.registerHoverProvider"),t("OutboundLink")],1),e._v(" API")]),e._v(" "),t("li",[e._v("Server\n"),t("ol",[t("li",[e._v("提供 Client + Server")]),e._v(" "),t("li",[e._v("Client 像方法1一样独立的插件运行；另外有进程与 Server 通过 Protocol 通信")]),e._v(" "),t("li",[e._v("Client 接受 vscode 响应，通知 Server 处理，再反馈给 vscode；Server 使用 LSP 接口")])]),e._v(" "),t("blockquote",[t("p",[e._v("比方法1麻烦，但是 Server 端不限制开发语言；一个 Server 可以同时为不同编辑器提供服务")])])])])]),e._v(" "),t("li",[e._v("常用接口\n"),t("ul",[t("li",[e._v("代码补全 Auto completion: "),t("a",{attrs:{href:"https://code.visualstudio.com/api/references/vscode-api#languages.registerCompletionItemProvider",target:"_blank",rel:"noopener noreferrer"}},[e._v("VS Code API"),t("OutboundLink")],1),e._v("/"),t("a",{attrs:{href:"https://microsoft.github.io/language-server-protocol/specification#textDocument_completion",target:"_blank",rel:"noopener noreferrer"}},[e._v("LSP method"),t("OutboundLink")],1)]),e._v(" "),t("li",[e._v("定义跳转 Jump to definition: "),t("a",{attrs:{href:"https://code.visualstudio.com/api/references/vscode-api#languages.registerDefinitionProvider",target:"_blank",rel:"noopener noreferrer"}},[e._v("VS Code API"),t("OutboundLink")],1),e._v("/"),t("a",{attrs:{href:"https://microsoft.github.io/language-server-protocol/specification#textDocument_definition",target:"_blank",rel:"noopener noreferrer"}},[e._v("LSP method"),t("OutboundLink")],1)]),e._v(" "),t("li",[e._v("Hover: "),t("a",{attrs:{href:"https://code.visualstudio.com/api/references/vscode-api#languages.registerHoverProvider",target:"_blank",rel:"noopener noreferrer"}},[e._v("VS Code API"),t("OutboundLink")],1),e._v("/"),t("a",{attrs:{href:"https://microsoft.github.io/language-server-protocol/specification#textDocument_hover",target:"_blank",rel:"noopener noreferrer"}},[e._v("LSP method"),t("OutboundLink")],1)]),e._v(" "),t("li",[e._v("...")])])]),e._v(" "),t("li",[e._v("错误验证\n"),t("ul",[t("li",[e._v("Client 不是发验证请求")]),e._v(" "),t("li",[e._v("Server 会"),t("strong",[e._v("push")]),e._v(" "),t("code",[e._v("textDocument/publishDiagnostics")]),e._v(" 信息给 Client")])])])])])])]),e._v(" "),t("li",[e._v("定义 "),t("code",[e._v("packages.json")]),e._v(" "),t("ul",[t("li",[t("code",[e._v("categories: ['Programming Languages']")])]),e._v(" "),t("li",[e._v("指定语法 json TextMate grammars "),t("code",[e._v("contributes.grammars")]),e._v(" "),t("ul",[t("li",[e._v("json file path "),t("code",[e._v("path")])]),e._v(" "),t("li",[e._v("内嵌的 languages "),t("code",[e._v("embeddedLanguages")])])])]),e._v(" "),t("li",[e._v("语言配置 "),t("code",[e._v("contributes.languages")]),e._v(" "),t("ul",[t("li",[e._v("config file path "),t("code",[e._v("configuration")])])])])])])]),e._v(" "),t("h2",{attrs:{id:"实现细节"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#实现细节"}},[e._v("#")]),e._v(" 实现细节")]),e._v(" "),t("ul",[t("li",[e._v("定义激活插件时机 "),t("code",[e._v("packages.json.activationEvents = 'onLanguage:vue'")])]),e._v(" "),t("li",[e._v("server\n"),t("ul",[t("li",[t("code",[e._v("createConnection()")])])])]),e._v(" "),t("li",[e._v("client\n"),t("ul",[t("li",[t("code",[e._v("new LanguageClient(id, name, ServerOptions, LanguageClientOptions)")])]),e._v(" "),t("li",[t("code",[e._v("client.start()")])])])]),e._v(" "),t("li",[e._v("mode 划分\n"),t("blockquote",[t("p",[e._v("vue,pug,'vue-html',css,postcss,scss,less,stylus,javascript,typescript,tsx")])]),e._v(" "),t("ol",[t("li",[e._v("获取文档 "),t("code",[e._v("doc: TextDocument")]),e._v(" - "),t("code",[e._v("new TextDocuments().listen(connection).get(uri)")])]),e._v(" "),t("li",[e._v("判定mode\n"),t("ol",[t("li",[e._v("解析（文本扫描，正则匹配）整个文本 "),t("code",[e._v("doc.getText()")]),e._v("，构成‘位置-mode’组合")]),e._v(" "),t("li",[e._v("根据用户当前聚焦位置 position 确定 mode")])])])])]),e._v(" "),t("li",[e._v("功能\n"),t("blockquote",[t("p",[e._v("不同 mode 具有类似功能，但实现不同")])]),e._v(" "),t("ul",[t("li",[t("code",[e._v("connection.onCompletion")]),e._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://github.com/vuejs/vetur/blob/master/server/src/modes/template/services/htmlCompletion.ts",target:"_blank",rel:"noopener noreferrer"}},[e._v("html"),t("OutboundLink")],1),e._v(": 当前组件的 props,data,computed,methods / 支持的组件库(vetur内置+配有vetur)组件,属性配置数据+当前组件\n"),t("blockquote",[t("p",[e._v("从工程 "),t("code",[e._v("package.json.dependencies")]),e._v(" 判断是否有"),t("a",{attrs:{href:"https://github.com/vuejs/vetur/blob/master/server/src/modes/template/tagProviders/index.ts",target:"_blank",rel:"noopener noreferrer"}},[e._v("配置vetur的依赖"),t("OutboundLink")],1)])])])])]),e._v(" "),t("li",[t("code",[e._v("connection.onDefinition")]),e._v(" "),t("ul",[t("li",[e._v("html: 只取当前文件定义的子组件，且有.d.ts文件\n"),t("blockquote",[t("p",[e._v("解析 script mode 时，用 ts 编译文件，获取 export 的 components 内容")])])])])]),e._v(" "),t("li",[t("code",[e._v("connection.onHover")])]),e._v(" "),t("li",[e._v("...")])])])])])}),[],!1,null,null,null);t.default=n.exports}}]);