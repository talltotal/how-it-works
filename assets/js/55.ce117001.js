(window.webpackJsonp=window.webpackJsonp||[]).push([[55],{320:function(t,a,n){"use strict";n.r(a);var s=n(14),e=Object(s.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"cache-loader"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cache-loader"}},[t._v("#")]),t._v(" "),a("a",{attrs:{href:"https://github.com/webpack-contrib/cache-loader",target:"_blank",rel:"noopener noreferrer"}},[t._v("cache-loader"),a("OutboundLink")],1)]),t._v(" "),a("blockquote",[a("p",[t._v("将其他loader处理后的文本和依赖关系，持久化储存；下次取时直接返回。")])]),t._v(" "),a("p",[t._v("webpack 匹配执行 loader 顺序：")]),t._v(" "),a("ol",[a("li",[t._v("从首向尾依次执行loader的"),a("code",[t._v("pitch")]),t._v("属性函数")]),t._v(" "),a("li",[t._v("从尾向首依次执行loader的"),a("code",[t._v("default")]),t._v("函数")])]),t._v(" "),a("p",[t._v("由此，在"),a("code",[t._v("pitch")]),t._v("中做拦截判断，取得缓存后直接返回：")]),t._v(" "),a("ol",[a("li",[t._v("以"),a("code",[t._v("options.cacheIdentifier")]),t._v("以及"),a("code",[t._v("remainingRequest")]),t._v("做hash处理为"),a("code",[t._v("key")]),t._v("，取得储存的文件")]),t._v(" "),a("li",[t._v("判断"),a("code",[t._v("remainingRequest")]),t._v("一致")]),t._v(" "),a("li",[t._v("比对所有dep"),a("strong",[t._v("文件修改时间")]),t._v("（"),a("code",[t._v("FS.stat")]),t._v("），全部一致则认为缓存可用")]),t._v(" "),a("li",[t._v("提供依赖，返回原处理结果")])]),t._v(" "),a("p",[t._v("在"),a("code",[t._v("default")]),t._v("函数中持久化其他loader的处理结果：")]),t._v(" "),a("ol",[a("li",[t._v("获取依赖")]),t._v(" "),a("li",[t._v("获取各依赖的文件修改时间")]),t._v(" "),a("li",[t._v("储存")])]),t._v(" "),a("p",[t._v("储存结构：")]),t._v(" "),a("div",{staticClass:"language-ts extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ts"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    remainingRequest"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" String"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    dependencies"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        path"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" String"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        mtime"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Date"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    contextDependencies"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        path"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" String"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        mtime"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Date"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    result"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        type"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" String"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        data"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" String"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])}),[],!1,null,null,null);a.default=e.exports}}]);