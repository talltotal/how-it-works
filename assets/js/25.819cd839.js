(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{290:function(e,v,_){"use strict";_.r(v);var t=_(14),s=Object(t.a)({},(function(){var e=this,v=e._self._c;return v("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[v("h1",{attrs:{id:"pdf-js"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#pdf-js"}},[e._v("#")]),e._v(" "),v("a",{attrs:{href:"https://github.com/mozilla/pdf.js",target:"_blank",rel:"noopener noreferrer"}},[e._v("pdf.js"),v("OutboundLink")],1)]),e._v(" "),v("blockquote",[v("p",[e._v("pdf（Portable Document Format） 的 HTML5 查看器")])]),e._v(" "),v("ul",[v("li",[e._v("stream 流\n"),v("blockquote",[v("p",[e._v("文件流管理")])]),e._v(" "),v("ul",[v("li",[e._v("node\n"),v("ul",[v("li",[e._v("根据协议"),v("code",[e._v("file:")]),e._v("区分，"),v("code",[e._v("fs.createReadStream")])]),e._v(" "),v("li",[e._v("根据协议"),v("code",[e._v("http:")]),e._v("区分，"),v("code",[e._v("http.request")]),e._v(" / "),v("code",[e._v("https.request")]),e._v(" => "),v("code",[e._v("response")])])])]),e._v(" "),v("li",[e._v("浏览器页面/chrome插件\n"),v("ul",[v("li",[v("code",[e._v("XMLHttpRequest")]),e._v(" / "),v("code",[e._v("fetch")])])])])])]),e._v(" "),v("li",[e._v("worker\n"),v("blockquote",[v("p",[e._v("使用 web worker 保证大文件处理的性能")])]),e._v(" "),v("ul",[v("li",[e._v("消息管理\n"),v("ul",[v("li",[e._v("约定通信的数据结构")]),e._v(" "),v("li",[e._v("管理注册的事件，每个事件名只能有一个事件")]),e._v(" "),v("li",[e._v("用递增id管理需要响应的请求，请求用"),v("code",[e._v("Promise")]),e._v("定义")]),e._v(" "),v("li",[e._v("用递增id管理传递流的请求，请求用"),v("code",[e._v("ReadableStream")]),e._v("定义\n"),v("blockquote",[v("p",[e._v("在两端消息内用‘暗语’传递状态变更")])]),e._v(" "),v("ol",[v("li",[e._v("请求方"),v("code",[e._v("ReadableStream.start")]),e._v("‘发送请求’")]),e._v(" "),v("li",[e._v("响应方‘初始操作’、‘发送暗语-开始吧’")]),e._v(" "),v("li",[e._v("请求方"),v("code",[e._v("ReadableStream.start")]),e._v("的"),v("code",[e._v("promise")]),e._v("完成，"),v("code",[e._v("ReadableStream.pull")]),e._v("‘发送暗语-传吧’")]),e._v(" "),v("li",[e._v("响应方‘执行流获取操作’、‘发送暗语-给你流内容’；完了‘发送暗语-没了’、‘发送暗语-关闭’")]),e._v(" "),v("li",[e._v("请求方"),v("code",[e._v("controller.enqueue()")]),e._v("数据入流；"),v("code",[e._v("ReadableStream.pull")]),e._v("的"),v("code",[e._v("promise")]),e._v("完成，"),v("code",[e._v("controller.close()")])])])])])]),e._v(" "),v("li",[e._v("主线程\n"),v("ul",[v("li",[e._v("worker文件加载管理\n"),v("ul",[v("li",[v("code",[e._v("onready")]),e._v("-"),v("code",[e._v("sendtest")]),e._v("-"),v("code",[e._v("ontest")]),e._v("，做"),v("code",[e._v("三次握手")]),e._v("确保worker准备好了")])])]),e._v(" "),v("li",[e._v("缓存worker处理过的数据")]),e._v(" "),v("li",[e._v("流获取操作")])])]),e._v(" "),v("li",[e._v("worker线程\n"),v("ul",[v("li",[e._v("消息管理")]),e._v(" "),v("li",[e._v("初始化的握手，"),v("code",[e._v("sendready")]),e._v("-"),v("code",[e._v("ontest")]),e._v("-"),v("code",[e._v("sendtest")])]),e._v(" "),v("li",[e._v("流处理操作")])])])])]),e._v(" "),v("li",[e._v("pdf\n"),v("ul",[v("li",[e._v("基本格式\n"),v("blockquote",[v("p",[e._v("PostScript\n内容按对象存储，页面由对对象的引用构成，文件首位做标识做辨认\n线性内容，即只有一个对象，直接按页面展示？")])]),e._v(" "),v("ul",[v("li",[e._v("HEADER\n"),v("ul",[v("li",[v("code",[e._v("%PDF-${version}")])]),e._v(" "),v("li",[e._v("验证字符‘%PDF-’："),v("code",[e._v("new Uint8Array([0x25, 0x50, 0x44, 0x46, 0x2d])")])]),e._v(" "),v("li",[e._v("取版本号：取非空格字符，最长7个字符")])])]),e._v(" "),v("li",[e._v("对象\n"),v("ul",[v("li",[e._v("结束标识‘endobj’："),v("code",[e._v("new Uint8Array([0x65, 0x6e, 0x64, 0x6f, 0x62, 0x6a])")])])])]),e._v(" "),v("li",[e._v("XRef\n"),v("blockquote",[v("p",[e._v("交叉引用表")])]),e._v(" "),v("ul",[v("li",[e._v("开始标识\n"),v("blockquote",[v("p",[e._v("不一定有")])]),e._v(" "),v("ul",[v("li",[v("code",[e._v("startxref ${开始位置}")])]),e._v(" "),v("li",[e._v("从文件最后开始找字符‘startxref’："),v("code",[e._v("new Uint8Array([0x73, 0x74, 0x61, 0x72, 0x74, 0x78, 0x72, 0x65, 0x66])")])])])]),e._v(" "),v("li",[e._v("xref 表示一个‘交叉引用表’的开始")])])])])]),e._v(" "),v("li",[e._v("语法解析")])])])]),e._v(" "),v("h2",{attrs:{id:"目录结构"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#目录结构"}},[e._v("#")]),e._v(" 目录结构")]),e._v(" "),v("ul",[v("li",[e._v("docs 文档，由"),v("code",[e._v("wintersmith")]),e._v("根据"),v("code",[e._v("./config.json")]),e._v("配置构建，加上"),v("code",[e._v("jsdoc")]),e._v("，交付在"),v("code",[e._v("gh-pages")]),e._v("分支，用于github-doc")])]),e._v(" "),v("h2",{attrs:{id:"构建"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#构建"}},[e._v("#")]),e._v(" 构建")]),e._v(" "),v("ul",[v("li",[e._v("chrome 插件 "),v("code",[e._v("gulp chromium")]),e._v(" "),v("ul",[v("li",[e._v("对"),v("code",[e._v("src/pdf.js")]),e._v("、"),v("code",[e._v("src/pdf.worker.js")]),e._v("和"),v("code",[e._v("web/viewer.js")]),e._v("做"),v("code",[e._v("webpack")]),e._v("打包输出")])])]),e._v(" "),v("li",[e._v("文件获取服务 "),v("code",[e._v("gulp server")])]),e._v(" "),v("li",[e._v("编译 "),v("code",[e._v("gulp generic")])]),e._v(" "),v("li",[e._v("交付编译 "),v("code",[e._v("gulp dist-install")])])]),e._v(" "),v("h3",{attrs:{id:"buildnumber"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#buildnumber"}},[e._v("#")]),e._v(" buildnumber")]),e._v(" "),v("ol",[v("li",[e._v("获取本次编译信息\n"),v("ul",[v("li",[e._v("以"),v("code",[e._v("git``commit")]),e._v("信息为依据")]),e._v(" "),v("li",[e._v("从‘某基础版本-commit’开始的数字数为版本号（随机递增的效果）")]),e._v(" "),v("li",[e._v("最后一次commit的hash为标记。")])])]),e._v(" "),v("li",[e._v("生成文件"),v("code",[e._v("version.json")])])]),e._v(" "),v("h3",{attrs:{id:"default-preferences"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#default-preferences"}},[e._v("#")]),e._v(" default_preferences")]),e._v(" "),v("div",{staticClass:"language-js extra-class"},[v("pre",{pre:!0,attrs:{class:"language-js"}},[v("code",[v("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("\n    "),v("span",{pre:!0,attrs:{class:"token string"}},[e._v('"src/{display,shared}/*.js"')]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n    "),v("span",{pre:!0,attrs:{class:"token string"}},[e._v('"!src/shared/{cffStandardStrings,fonts_utils}.js"')]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n    "),v("span",{pre:!0,attrs:{class:"token string"}},[e._v('"src/pdf.js"')]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n    "),v("span",{pre:!0,attrs:{class:"token string"}},[e._v('"web/*.js"')]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n    "),v("span",{pre:!0,attrs:{class:"token string"}},[e._v('"!web/{app,pdfjs,preferences,viewer}.js"')]),e._v("\n"),v("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n")])])]),v("ol",[v("li",[e._v("做本工程逻辑的预处理\n"),v("ol",[v("li",[v("code",[e._v("acorn")]),e._v("做代码解析，构建AST")]),e._v(" "),v("li",[e._v("在AST上处理本工程逻辑")]),e._v(" "),v("li",[v("code",[e._v("escodegen")]),e._v("从AST再生成代码")])])]),e._v(" "),v("li",[e._v("使用babel做向后兼容编译")]),e._v(" "),v("li",[e._v("获取并生成文件"),v("code",[e._v("default_preferences.json")])])]),e._v(" "),v("h3",{attrs:{id:"locale"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#locale"}},[e._v("#")]),e._v(" locale")]),e._v(" "),v("ol",[v("li",[e._v("遍历"),v("code",[e._v("I18n")]),e._v("文件夹内的文件夹，并验证处理")]),e._v(" "),v("li",[e._v("拷贝文件夹内的"),v("code",[e._v("viewer.properties")]),e._v("文件")]),e._v(" "),v("li",[e._v("拼接引用文本，生成文件"),v("code",[e._v("locale.properties")])])])])}),[],!1,null,null,null);v.default=s.exports}}]);